!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("angular")):"function"==typeof define&&define.amd?define(["module","angular"],function(e,n){e.exports=t(n)}):t(e.angular)}(this,function(e){function t(t,o,i,d){function a(n,a,c,u){function p(){var i=t(f());I.container=i(n),I.options.containerCssClass&&I.container.addClass(I.options.containerCssClass),I.options.dropdownParent?I.options.dropdownParent.append(I.container):(o.find("body").append(I.container),I.container.addClass("auto-complete-absolute-container")),I.elementUL=e.element(I.container[0].querySelector("ul.auto-complete-results"))}function f(){var e="";return e+='<div class="auto-complete-container unselectable"',e+='     data-instance-id="{{ ctrl.instanceId }}"',e+='     ng-show="ctrl.containerVisible">',e+='     <ul class="auto-complete-results">',e+='         <li ng-repeat="item in ctrl.renderItems track by $index"',e+='             ng-click="ctrl.selectItem($index, true)"',e+='             class="auto-complete-item" data-index="{{ $index }}"',e+='             ng-class="ctrl.getSelectedCssClass($index)">',e+='                 <div bind-html-compile="item.label"></div>',e+="         </li>",e+="     </ul>",e+="</div>"}function m(){function t(e){return[l.TAB,l.ALT,l.CTRL,l.LEFTARROW,l.RIGHTARROW,l.MAC_COMMAND_LEFT,l.MAC_COMMAND_RIGHT].indexOf(e)!==-1}function r(e){var n=e.charCode||e.keyCode||0;if(!t(n))return n===l.UPARROW?(I.scrollToItem(-1),e.stopPropagation(),void e.preventDefault()):n===l.DOWNARROW?(I.scrollToItem(1),e.stopPropagation(),void e.preventDefault()):n===l.ENTER?(I.selectItem(I.selectedIndex,!0),e.preventDefault(),void e.stopPropagation()):n===l.ESCAPE?(I.hide(),I.restoreOriginalText(),e.preventDefault(),void e.stopPropagation()):void 0}function s(){var e=a.val();return e.length<I.options.minimumChars?(I.hide(),void I.empty()):void c(e)}function c(e,t){var n=d(function(){e===a.val()&&I.fetch(e),d.cancel(n)},t||300)}a.on("focus",function(){n.$evalAsync(function(){I.activate(),I.options.activateOnFocus&&c(a.val(),100)})}),a.on("input",function(){n.$evalAsync(s)}),a.on("keydown",function(e){var t=e;n.$evalAsync(function(){r(t)})}),o.on("keydown",w),o.on("click",C),e.element(i).on("resize",g)}function h(){r.hideAllInactive()}function v(e){if(r.hideAllInactive(),!I.isInline()&&I.container)return e.target===I.target[0]?void e.stopPropagation():I.container.has(e.target).length>0?void e.stopPropagation():void I.hide()}function w(e){var t=e;n.$evalAsync(function(){h(t)})}function g(){n.$evalAsync(function(){I.hide()})}function C(e){var t=e;n.$evalAsync(function(){v(t)})}var I=u[0];I.textModelCtrl=u[1],r.addDirectiveCtrl(I),I.target=a,d(function(){var t=I.options()||{};I.init(e.extend({},s,t)),p(),m()});var b=n.$on("$destroy",function(){I.container&&(I.container.remove(),I.container=null),o.off("keydown",w),o.off("click",C),e.element(i).off("resize",g),b()})}return{restrict:"A",scope:{},transclude:!1,controllerAs:"ctrl",bindToController:{options:"&autoComplete"},require:["autoComplete","ngModel"],link:a,controller:n}}function n(t,n,o,i,l,s,d,a){function c(t,n){if(e.isFunction(t))try{return t.call(b.target,n)}catch(o){}}function u(){if(!b.isInline()){var e=b.target[0].getBoundingClientRect();"auto"===b.options.dropdownWidth?b.container.css({width:e.width+"px"}):b.container.css({width:b.options.dropdownWidth}),"auto"!==b.options.dropdownHeight&&b.elementUL.css({height:b.options.dropdownHeight}),b.options.positionUsingJQuery&&p()?f():m()}}function p(){return window.jQuery&&window.jQuery.ui}function f(){if(p()){var t={my:"left top",at:"left bottom",of:b.target,collision:"none flip"},n=e.extend({},t,b.options.positionUsing);b.containerVisible=!0,b.container.css({visibility:"hidden"}),l(function(){b.container.position(n),b.container.css({visibility:"visible"})})}}function m(){var e=b.target[0].getBoundingClientRect(),t=o[0].body.scrollTop||o[0].documentElement.scrollTop||n.pageYOffset,i=o[0].body.scrollLeft||o[0].documentElement.scrollLeft||n.pageXOffset;b.container.css({left:e.left+i+"px",top:e.top+e.height+t+"px"}),b.containerVisible=!0}function h(){var e=b.renderItems[b.selectedIndex];e&&v(e.value)}function v(e){b.target.val(e),b.textModelCtrl.$setViewValue(e)}function w(t,n){var o=n.length<b.options.maxItemsToRender?n.length:b.options.maxItemsToRender,i=n.slice(0,o),r=[];e.forEach(i,function(e){var n=t(e);n&&n.label&&n.value&&(n.data=e,r.push(n))}),b.renderItems=r,b.show()}function g(){if(e.isFunction(b.options.renderItem)&&b.options.renderItem!==e.noop)return t.when(b.options.renderItem);if(b.options.itemTemplateUrl)return C();var n=b.options.itemTemplate||"<span>{{item}}</span>";return t.when(I.bind(null,s(n,!1)))}function C(){return d(b.options.itemTemplateUrl).then(function(t){return function(n){var o=e.isObject(n)&&b.options.selectedTextAttr?n[b.options.selectedTextAttr]:n;return{value:o,label:i.trustAsHtml(t)}}})["catch"](a)["catch"](e.noop)}function I(t,n){var o=e.isObject(n)&&b.options.selectedTextAttr?n[b.options.selectedTextAttr]:n;return{value:o,label:i.trustAsHtml(t({item:n}))}}var b=this,T=null;this.target=null,this.selectedIndex=-1,this.renderItems=[],this.containerVisible=!1,this.isInline=function(){return e.isElement(b.options.dropdownParent)},this.init=function(e){this.options=e,this.instanceId=r.getNewInstanceId()},this.activate=function(){T=null,r.setActiveInstanceId(b.instanceId)},this.fetch=function(e){T=e,c(b.options.loading),t.when(b.options.data(e),function(t){var n=b.textModelCtrl.$viewValue;n&&e!==n||(b.renderList(t,e),c(b.options.loadingComplete))},function(e){b.hide(),c(b.options.loadingComplete,{error:e})})},this.renderList=function(e){return b.empty(),e&&0!==e.length?void g().then(function(t){w(t,e)}):void b.hide()},this.show=function(){u(),c(b.options.dropdownShown)},this.hide=function(){b.containerVisible&&(b.elementUL[0].scrollTop=0,b.containerVisible=!1,c(b.options.dropdownHidden))},this.restoreOriginalText=function(){T&&v(T)},this.empty=function(){b.selectedIndex=-1,b.renderItems=[]},this.scrollToItem=function(e){if(b.containerVisible){var t=b.selectedIndex+e,n=b.renderItems[t];if(n){b.selectItem(t);var o='li[data-index="'+t+'"]';if(window.jQuery&&window.jQuery.scrollTo)return void b.elementUL.scrollTo(b.elementUL.find(o));var i=b.elementUL[0].querySelector(o);i&&(b.elementUL[0].scrollTop=i.offsetTop)}}},this.selectItem=function(e,t){var n=b.renderItems[e];n&&(b.selectedIndex=e,h(),t&&(b.isInline()||b.hide(),c(b.options.itemSelected,{item:n.data})))},this.getSelectedCssClass=function(e){return e===b.selectedIndex?b.options.selectedCssClass:""}}function o(){var t=this,n=[],o=0,i=0;this.addDirectiveCtrl=function(e){e&&n.push(e)},this.getNewInstanceId=function(){return o++},this.setActiveInstanceId=function(e){i=e,t.hideAllInactive()},this.hideAllInactive=function(){e.forEach(n,function(e){e.isInline()||e.instanceId===i||e.hide()})}}function i(){this.getDefaultOptionsDoc=function(){return d}}var r=new o;e.module("autoCompleteModule",["ngSanitize"]).service("autoCompleteService",i).directive("bindHtmlCompile",["$compile",function(e){return{restrict:"A",link:function(t,n,o){t.$watch(function(){return t.$eval(o.bindHtmlCompile)},function(i){n.html(i&&i.toString());var r=t;o.bindHtmlScope&&(r=t.$eval(o.bindHtmlScope)),e(n.contents())(r)})}}}]).directive("autoComplete",t),t.$inject=["$compile","$document","$window","$timeout"],n.$inject=["$q","$window","$document","$sce","$timeout","$interpolate","$templateRequest","$exceptionHandler"];var l={TAB:9,ENTER:13,CTRL:17,ALT:18,ESCAPE:27,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40,MAC_COMMAND_LEFT:91,MAC_COMMAND_RIGHT:93},s={containerCssClass:null,selectedCssClass:"auto-complete-item-selected",minimumChars:1,maxItemsToRender:20,activateOnFocus:!1,dropdownWidth:"auto",dropdownHeight:"auto",dropdownParent:null,selectedTextAttr:null,itemTemplate:null,itemTemplateUrl:null,positionUsingJQuery:!0,positionUsing:null,loading:e.noop,data:e.noop,loadingComplete:e.noop,renderItem:e.noop,itemSelected:e.noop,dropdownShown:e.noop,dropdownHidden:e.noop},d={containerCssClass:{def:"null",doc:"CSS class applied to the dropdown container"},selectedCssClass:{def:"auto-complete-item-selected",doc:"CSS class applied to the selected list element"},minimumChars:{def:"1",doc:"Minimum number of characters required to display the dropdown."},maxItemsToRender:{def:"20",doc:"Maximum number of items to render in the list."},activateOnFocus:{def:"false",doc:"If true will display the dropdown list when the textbox gets focus."},dropdownWidth:{def:"auto",doc:'Width in "px" of the dropddown list.'},dropdownHeight:{def:"auto",doc:'Height in "px" of the dropddown list.'},dropdownParent:{def:"null",doc:"a jQuery object to append the dropddown list."},selectedTextAttr:{def:"null",doc:"If the data for the dropdown is a collection of objects, this should be the name of a property on the object. The property value will be used to update the input textbox."},itemTemplate:{def:"null",doc:'A template for the dropddown list item. For example "<div>{{item.lastName}} - {{item.jobTitle}}</div>".'},itemTemplateUrl:{def:"null",doc:"This is similar to template but the template is loaded from the specified URL, asynchronously."},positionUsingJQuery:{def:"false",doc:'If true will position the dropdown list using the position() method from the jQueryUI library. See <a href="https://api.jqueryui.com/position/">jQueryUI.position() documentation</a>'},positionUsing:{def:"null",doc:"Options that will be passed to jQueryUI position() method."},loading:{def:"noop",doc:"Callback before getting the data for the dropdown."},data:{def:"noop",doc:"Callback for data for the dropdown. Must return a promise"},loadingComplete:{def:"noop",doc:"Callback after the items are rendered in the dropdown."},renderItem:{def:"noop",doc:'Callback for custom rendering a list item. This is called for each item in the dropdown. It must return an object literal with "value" and "label" properties, where "label" is the safe html for display and "value" is the text for the textbox'},itemSelected:{def:"noop",doc:"Callback after an item is selected from the dropdown."},dropdownShown:{def:"noop",doc:"Callback after the dropdown is hidden."},dropdownHidden:{def:"noop",doc:"Callback after the dropdown is shown."}}});